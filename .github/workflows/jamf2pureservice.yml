name: Jamf2Pureservice

on:
  workflow_dispatch:
  # schedule:
  #   - cron: "15 23 * * 0"

jobs:
  jamf2pureservice:

    runs-on: [self-hosted, docker, macOS]
    environment:
      name: production

    steps:
    - uses: actions/checkout@v4
    - name: Set .env
      run: |
        echo "${{ vars.LARAVEL_ENV }}" > .env
    - name: Install dependencies
      run: composer install
    - name: Run Jamf2Pureservice
      run: |
        ./artisan migrate:fresh --force
        ./artisan pureservice:sync-jamf
